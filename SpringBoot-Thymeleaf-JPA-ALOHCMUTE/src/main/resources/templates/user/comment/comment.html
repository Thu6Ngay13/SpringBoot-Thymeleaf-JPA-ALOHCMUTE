<!DOCTYPE html>
<html
	xmlns:th "http://www.thymeleaf.org" xmlns:layout="http://ww.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{user/layout-user.html}">

<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Trang comment</title>
<link
	th:href="@{https://fonts.googleapis.com/icon?family=Material+Icons}"
	rel="stylesheet" />
<link rel="stylesheet"
	th:href="@{https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css}"
	integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
	crossorigin="anonymous">
<meta name="viewport"
	content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link rel="stylesheet"
	href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<link rel="stylesheet" th:href="@{/css/style_comment.css}">
<title>Boostrap Login | Ludiflex</title>
</head>

<body>

	<!----------------------- Main Container -------------------------->
	<div
		class=" container d-flex justify-content-center align-items-center min-vh-100">
		<!----------------------- Login Container -------------------------->
		<div class="row border  p-3 bg-white shadow box-area"
			layout:fragment="content">
			<!----------------------- Left Container -------------------------->

			<div
				class="col-md-6 rounded-4 d-flex justify-content-center align-items-center flex-column left-box";>
				<div class="featured-images mb-3">
					<img th:src="@{/images/image_picture.png}" class="img-fluid"
						style="width: 850px;">
				</div>
			</div>


			<!----------------------- Right Container -------------------------->

			<div class="col-md-6 right-box">
				<div class="row align-items-center">


					<div class="d-flex skfjkk flex-wrap">
						<div class="lkt40">
							<img th:src="@{/images/image_avt.png}" alt="">
						</div>

						<div class="name flex-grow-1">
							<h6 class=" mb-1 fs-5 fw-bold d-flex">Thanh Huyền</h6>
							<p class="text-muted small mb-1 fs-7 d-flex">Gia Lai - Tháng
								1 - 2020</p>
						</div>

					</div>

					<hr>
					<p class="text-muted">Hom nay ban co on khong?</p>
					<div class="d-flex">
			            <p class="count-like">
			              <span id="likeText" th:text="${soLike}"></span>
			            </p>
			            <p class="count-comment" ><span th:text="${soLuongBinhLuan}" ></span>&nbsp;comments</p>
			         </div>

					<div class="post__options d-flex icon">
						
						<div class="post__option d-flex">
							<span class="material-icons fs-5 like" th:classappend="${isLiked} ? 'liked' : ''" onclick ="toggleLike(this)"> thumb_up </span>
							<input type="hidden" th:value="${soLike}" id="likeCount"/>
							<input type="hidden" th:value="${baiVietId}" id="baiVietId"/>
							<p class="icon">Like</p>
						</div>
						<script>
						let likeCount = document.getElementById('likeCount').value;
				              function toggleLike(element) {
				            	  likeCount = Number(likeCount);
				            	  let isLiked = element.classList.contains('liked');
				            	  let action = "";
				                  if (isLiked) {
				                      element.classList.remove('liked');
				                      action = "nolike";
				                      likeCount = likeCount - 1;
				                  } else {
				                      element.classList.add('liked');
				                      action = "like";
				                      likeCount = likeCount + 1;
				                  }
				                  like(action);
				                  document.getElementById('likeText').innerText = likeCount + " likes";
				              }
				          </script>

						<div class=" post__option d-flex icon">
							<span class="material-icons fs-5"> chat_bubble_outline </span>
							<p class="icon">Comment</p>
						</div>

						<div class="post__option d-flex icon">
							<span class="material-icons fs-5"> near_me </span>
							<p class="icon">Share</p>
						</div>
					</div>
					<hr>

					<div class="listcmt  overflow-auto">

						<th:block th:each="cmt : ${comments}">
							<div class="card mb-2">
								<div class="card-body">
									<p th:text="${cmt.noiDungChu}"></p>

									<div class="d-flex justify-content-between">
										<div class="d-flex flex-row align-items-center">
											<img th:src="@{/images/image_avt.png}" alt="avatar"
												width="25" height="25" />
											<p class="small mb-0 ms-2" th:text="${cmt.taiKhoan.nickName}"></p>
										</div>
										<div class="d-flex flex-row align-items-center">
											<button type="button" class="btn btn-light btn-sm"
												data-toggle="modal" data-target="#updateComment" th:attr="data-comment=${cmt.maBinhLuan}">
												Chỉnh sửa</button>

											<i class="far fa-thumbs-up mx-2 fa-xs text-black"
												style="margin-top: -0.16rem;"></i>
											<button type="button" class="btn btn-light btn-sm">
												<a
													th:href="@{/user/comment/{baiVietId}/delete/{commentId}(baiVietId=${baiVietId}, commentId=${cmt.maBinhLuan})}"
													class="text-dark">Xóa</a>
											</button>
										</div>
									</div>
									<form action="#"
										th:action="@{/user/comment/{baiVietId}/update(baiVietId=${baiVietId})}"
										th:object="${binhLuan}" method="post">
										<div class="modal fade" id="updateComment" tabindex="-1"
											role="dialog" aria-labelledby="exampleModalLabel"
											aria-hidden="true">
											<div class="modal-dialog modal-dialog-centered"
												role="document">
												<div class="modal-content">
													<div class="modal-header">
														<h5 class="modal-title" id="exampleModalLabel">Chỉnh
															sửa bình luận</h5>
														<button type="button" class="close" data-dismiss="modal"
															aria-label="Close">
															<span aria-hidden="true">&times;</span>
														</button>
													</div>
													<div class="modal-body">
														<input type="text" class="form-control" th:field="*{noiDungChu}">
														<input type="hidden" th:value="${cmt.maBinhLuan}" th:field="*{maBinhLuan}" id="editedComment"/>
													</div>
													<div class="modal-footer">
														<button type="button" class="btn btn-secondary"
															data-dismiss="modal">Đóng</button>
														<button type="submit" class="btn btn-primary">Lưu
															thay đổi</button>
													</div>
												</div>
											</div>
										</div>
									</form>

									<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
									<script>
										  $(document).ready(function() {
											  $('#updateComment').on('show.bs.modal', function(event) {
										            var button = $(event.relatedTarget);
										            var comment = button.data('comment');
										            $('#editedComment').val(comment);
										        });
										    $('#updateComment').modal({
										      show: false
										    });
										
										    $('form').on('submit', function() {
										      $('#updateComment').modal('hide');
										    });
										  });
										</script>


									<div class="d-flex flex-row align-items-center mt-3">
										<p class="small text-muted mb-0" th:text="${cmt.ThoiGian}"></p>
										<i class="far fa-thumbs-up mx-2 fa-xs text-black"
											style="margin-top: -0.16rem;"></i>
										<p class="small text-muted mb-0" th:text="${cmt.Ngay}"></p>
									</div>

								</div>
							</div>
						</th:block>
					</div>

					<form class="d-flex  mt-3" action="#"
						th:action="@{{baiVietId}(baiVietId=${baiVietId})}"
						th:object="${binhLuan}" method="post">
						<div class="input-group">
							<input type="text"
								class="addcmt form-control form-control-lg bg-light fs-6"
								placeholder="Add a comment..." th:field="*{noiDungChu}"><br>
						</div>
						<input class="btn btn-light btn-sm" type="submit" value="Đăng" >
					</form>
					


				</div>
			</div>
	<script src="https://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
	<script>
		function like(action) {
			let baiVietId = document.getElementById('baiVietId').value;
	        let url = "http://localhost:8181/user/like/" + baiVietId;
	        if (action == 'nolike'){
	        	url = "http://localhost:8181/user/nolike/" + baiVietId;
	        }
			$.ajax({
				url : url,
				contentType: "application/json; charset=utf-8",
				type : "POST",
				data : JSON.stringify({'action': action}),
				cache: false,
				success : function(data) {
					console.log(action);
				},
				error : function(err) {
					console.log(err);
				}
			});
		}
	</script>

			<script
				th:src="@{https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js}"
				integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
				crossorigin="anonymous"></script>
			<script
				src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
			<script
				src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>

</html>